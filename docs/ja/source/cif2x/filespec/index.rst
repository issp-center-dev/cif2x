.. _sec-cif2x-fileformat:

======================
 ファイルフォーマット
======================

入力パラメータファイル
======================

入力パラメータファイルでは、cif2x で第一原理計算入力ファイルを生成するための設定情報を YAML形式で記述します。本ファイルは以下の部分から構成されます。

  1. structureセクション: 結晶構造データの扱いについてのオプションを記述します。

  2. optionalセクション: 擬ポテンシャルファイルの指定や、YAMLの参照機能を利用する場合のシンボル定義を行います。

  3. tasksセクション: 入力ファイルの内容を記述します。


structure
---------

  ``use_ibrav`` (デフォルト値: ``false``)

    結晶構造の入力に Quantum ESPRESSO の ``ibrav`` パラメータを利用します。 ``true`` の場合、格子のとり方を Quantum ESPRESSO の convention に合うように変換します。入力ファイルにはあわせて格子に関するパラメータ ``a``, ``b``, ``c``, ``cosab``, ``cosac``, ``cosbc`` が(必要に応じて)書き出されます。

  ``tolerance`` (デフォルト値: 0.01)

    ``use_ibrav = true`` の場合に、再構成した Structure データと元データとの一致を評価する際の許容度を指定します。

optional
--------

  ``pseudo_dir``

    擬ポテンシャルファイルを格納するディレクトリ名を指定します。 各taskの ``content`` に ``pseudo_dir`` が指定されている場合は後者が優先します。

  ``pp_file``

    元素種と擬ポテンシャルを対応付けるCSV形式のインデックスファイルを指定します。

tasks
-----
入力ファイルの内容を記述します。複数の入力ファイルに対応するため、 ``tasks`` には各入力ファイルごとのブロックからなるリスト形式をとります。各ブロックに記述する項目は以下のとおりです。

  ``mode``

    入力ファイルの計算内容を指定します。
    現時点では Quantum ESPRESSO の pw.x 向けに ``scf`` と ``nscf`` に対応しています。対応していない mode については、 ``content`` の内容をそのまま出力します。

  ``output_file``

    出力ファイル名を指定します。指定がない場合はエラーで終了します。
    
  ``output_dir``

    出力先のディレクトリ名を指定します。デフォルト値はカレントディレクトリです。

  ``content``

    出力内容を指定します。Quantum ESPRESSO の場合は ``namelist`` ブロックに namelist データ (``&system`` や ``&control`` など) を記述し、 ``K_POINTS`` 等の card データを個別のブロックとして記述します。card データはパラメータをとるものがあります。

  ``template``

    出力内容のテンプレートファイルを指定します。指定がない場合はテンプレートを利用しません。
    このファイルの内容を ``content`` に追加します。同じデータがある場合は後者を優先します。


Quantum ESPRESSO 向けパラメータ
===============================

``content`` に記述する内容について、Quantum ESPRESSO 固有の内容を記述します。
現時点では pw.x の ``scf`` および ``nscf`` に対応しています。

namelist
--------

- ``structure`` セクションの ``use_ibrav`` パラメータに応じて、 ``&system`` の格子情報の指定が上書きされます。

  - ``use_ibrav = false``:
    ``ibrav`` は 0 にセットされます。また、格子パラメータに関する ``a``, ``b``, ``c``, ``cosab``, ``cosac``, ``cosbc``, ``celldm`` は削除されます。

  - ``use_ibrav = true``:
    ``ibrav`` は結晶構造データから取得された Bravais 格子のインデックスがセットされます。また、Structure データは基本格子のとり方など Quantum ESPRESSO の convention に合わせて再構成されます。

- ``nat`` (原子数) および ``ntyp`` (元素種の数)は結晶構造データから取得される値で上書きされます。

- カットオフ ``ecutwfc`` および ``ecutrho`` の情報は、パラメータの値が空欄の場合は擬ポテンシャルファイルから取得します。

CELL_PARAMETERS
---------------

- ``structure`` セクションの ``use_ibrav`` パラメータが true の場合は出力されません。false の場合は格子ベクトルが出力されます。単位は angstrom です。

- 格子ベクトルの情報は結晶構造データから取得されます。 ``data`` フィールドに 3x3 の行列を直接指定した場合はその値が用いられます。

ATOMIC_SPECIES
--------------

- 原子種・原子量・擬ポテンシャルファイル名のリストを出力します。

- 原子種の情報は結晶構造データから取得されます。擬ポテンシャルのファイル名は ``pp_list`` で指定するCSV形式のインデックスファイルを参照します。

- ``data`` フィールドに必要なデータを指定した場合はその値が用いられます。

ATOMIC_POSITIONS
----------------

- 原子種と原子座標(fractional coordinate)のリストを出力します。

- ``ignore_species`` に原子種または原子種のリストを指定した場合、その原子種については ``if_pos`` の値が 0 にセットされます。MDや構造最適化の際に使われます。

- ``data`` フィールドに必要なデータを指定した場合はその値が用いられます。

K_POINTS
--------

- k点の情報を出力します。 ``option`` に出力タイプを指定します。

  - ``gamma``: :math:`\Gamma` 点を用います。

  - ``crystal``: メッシュ状の k点のリストを出力します。メッシュの指定は ``grid`` パラメータまたは ``vol_density`` や ``k_resolution`` から導出される値が用いられます。

  - ``automatic``: k点のメッシュを指定します。メッシュの指定は ``grid`` パラメータまたは ``vol_density`` や ``k_resolution`` から導出される値が用いられます。 シフトの指定は ``kshifts`` パラメータを参照します。
    
- メッシュの指定は以下の順序で決定されます。

  - ``grid`` パラメータの指定。grid の値は :math:`n_x, n_y, n_z` の配列またはスカラー値 :math:`n` です。後者の場合は :math:`n_x = n_y = n_z = n` と仮定します。
  - ``vol_density`` パラメータから自動導出。
  - ``k_resolution`` パラメータから自動導出。``k_resolution`` のデフォルトは 0.15 です。

- ``data`` フィールドに必要なデータを指定した場合はその値が用いられます。
