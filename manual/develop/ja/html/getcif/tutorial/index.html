<!DOCTYPE html>

<html lang="ja" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>7.2. チュートリアル &#8212; cif2x Users Guide 1.1.0 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=94bc0932" />
    <script src="../../_static/documentation_options.js?v=6599c6cf"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=91613774"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="7.3. コマンドリファレンス" href="../command/index.html" />
    <link rel="prev" title="7.1. 概要" href="../about/index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="sec-getcif-tutorial">
<span id="id1"></span><h1><span class="section-number">7.2. </span>チュートリアル<a class="headerlink" href="#sec-getcif-tutorial" title="Link to this heading">¶</a></h1>
<p>結晶構造などのデータを物質材料データベースから取得するツール getcif を使うには、検索条件と取得するデータを記述した入力パラメータファイルを作成し、プログラム getcif を実行します。現在は Materials Project が公開しているデータベースに対応しています。以下では <code class="docutils literal notranslate"><span class="pre">docs/tutorial/getcif</span></code> ディレクトリにある ABO3 系の物質を検索・取得するサンプルを例にチュートリアルを実施します。</p>
<section id="api">
<h2>APIキーを取得する<a class="headerlink" href="#api" title="Link to this heading">¶</a></h2>
<p>Materials Project のデータベースをプログラムから検索するには、あらかじめ Materials Project にユーザ登録し、APIキーを取得する必要があります。
Materials Project の公式サイト <a class="reference external" href="https://next-gen.materialsproject.org">https://next-gen.materialsproject.org</a> にアクセスし、Login します。APIキーはユーザ登録時に自動的生成され、ユーザのダッシュボードから確認できます。取得した APIキーは安全に保管し、他人に知られないようにしましょう。</p>
<p>APIキーを getcif にセットするには、以下のいずれかを実行します。</p>
<blockquote>
<div><ol class="loweralpha">
<li><p>pymatgen の設定ファイルに登録する</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pmg<span class="w"> </span>config<span class="w"> </span>--add<span class="w"> </span>PMG_MAPI_KEY<span class="w"> </span>&lt;API_KEY&gt;
</pre></div>
</div>
</div></blockquote>
<p>を実行するか、設定ファイル <code class="docutils literal notranslate"><span class="pre">~/.config/.pmgrc</span></code> に</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>PMG_MAPI_KEY:<span class="w"> </span>&lt;API_KEY&gt;
</pre></div>
</div>
</div></blockquote>
<p>を書き込みます。</p>
</li>
<li><p>環境変数にセットする</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nv">MP_API_KEY</span><span class="o">=</span><span class="s2">&quot;&lt;API_KEY&gt;&quot;</span>
$<span class="w"> </span><span class="nb">export</span><span class="w"> </span>MP_API_KEY
</pre></div>
</div>
</div></blockquote>
<p>を実行します。</p>
</li>
<li><p>ファイルに格納する</p>
<p>APIキーをファイルに書き込み、getcif を実行するディレクトリに配置します。ファイル名のデフォルトは <code class="docutils literal notranslate"><span class="pre">materials_project.key</span></code> です。異なるファイル名を使う場合は、入力パラメータファイル (input.yaml) の api_key_file にファイル名を指定します。ファイル名は <code class="docutils literal notranslate"><span class="pre">.key</span></code> の拡張子が必要です。</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">database</span><span class="p">:</span>
<span class="w">  </span><span class="nt">api_key_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">materials_project.key</span>
</pre></div>
</div>
</div></blockquote>
<p>註: バージョン管理ツールを使っている場合は、 <code class="docutils literal notranslate"><span class="pre">.key</span></code> の拡張子を持つファイルを管理から除外するとよいでしょう。(Git の場合は <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> ファイルに <code class="docutils literal notranslate"><span class="pre">*.key</span></code> を追加します。)</p>
</li>
</ol>
</div></blockquote>
</section>
<section id="id2">
<h2>入力パラメータファイルを作成する<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>入力パラメータファイルにはデータベース検索および出力についての設定を記述します。</p>
<p>以下に入力パラメータファイルのサンプルを記載します。このファイルは YAML形式のテキストファイルで、データベースへの接続に必要な情報や、検索条件、取得するデータの種類などの内容を記述します。仕様の詳細については <a class="reference internal" href="../filespec/index.html#sec-getcif-fileformat"><span class="std std-ref">ファイルフォーマット</span></a> の章を参照してください。</p>
<p>YAMLフォーマットでは、 <code class="docutils literal notranslate"><span class="pre">keyword:</span> <span class="pre">value</span></code> の辞書形式でパラメータを記述します。 <code class="docutils literal notranslate"><span class="pre">value</span></code> には数値や文字列などのスカラー値や、複数の値を <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code> または箇条書きの形式で列挙するリスト型、または辞書型を入れ子にすることができます。検索条件と出力項目については、特別な記法として、リスト型を括弧を使わず空白区切りで列挙する形式でも書くことができます。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">database</span><span class="p">:</span>
<span class="w">  </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">materials project</span>

<span class="nt">option</span><span class="p">:</span>
<span class="w">  </span><span class="nt">output_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result</span>
<span class="w">  </span><span class="c1"># dry_run: false</span>

<span class="nt">properties</span><span class="p">:</span>
<span class="w">  </span><span class="nt">band_gap</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt; 1.0</span>
<span class="w">  </span><span class="nt">is_stable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">is_metal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">formula</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;**O3&quot;</span>
<span class="w">  </span><span class="nt">spacegroup_symbol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pm-3m</span>

<span class="nt">fields</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">structure</span>
<span class="w">  </span><span class="no">band_gap</span>
<span class="w">  </span><span class="no">symmetry</span>
</pre></div>
</div>
<p>入力パラメータファイルは <code class="docutils literal notranslate"><span class="pre">database</span></code>, <code class="docutils literal notranslate"><span class="pre">option</span></code>, <code class="docutils literal notranslate"><span class="pre">properties</span></code>, <code class="docutils literal notranslate"><span class="pre">fields</span></code> のブロックからなります。
<code class="docutils literal notranslate"><span class="pre">database</span></code> にはデータベース接続に関する設定を記述します。例では <code class="docutils literal notranslate"><span class="pre">target</span></code> に Materials Project を指定していますが、現時点ではこの項目は無視されます。その他、 <code class="docutils literal notranslate"><span class="pre">api_key</span></code> に APIキーを指定できます。APIキーは pymatgen の設定ファイルや環境変数にセットすることもできます。例では後者の方式を仮定しています。</p>
<p><code class="docutils literal notranslate"><span class="pre">option</span></code> には実行時のオプションを記述します。 <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> は取得したデータの格納先ディレクトリを指定します。省略時にはカレントディレクトリに書き出されます。 <code class="docutils literal notranslate"><span class="pre">dry_run</span></code> を <code class="docutils literal notranslate"><span class="pre">true</span></code> にセットすると、データベースへの接続はせず、検索条件を出力して終了します。 <code class="docutils literal notranslate"><span class="pre">dry_run</span></code> はコマンドラインオプションでも指定できます。</p>
<p><code class="docutils literal notranslate"><span class="pre">properties</span></code> は検索条件の指定を行います。検索条件を「項目: 値」の書式で列挙し、これらの条件は AND で扱われます。例では、バンドギャップが 1.0以下、安定な絶縁体で、組成式は ABO3 (A, B は任意の元素種)、空間群は <code class="docutils literal notranslate"><span class="pre">Pm-3m</span></code> という条件を指定しています。 <code class="docutils literal notranslate"><span class="pre">band_gap</span></code> には値の範囲を上限・下限の組で指定するほか、 <code class="docutils literal notranslate"><span class="pre">&lt;</span> <span class="pre">1.0</span></code> のような記法も使用できます。検索条件にどのような項目が指定できるかは Appendix を参照してください。</p>
<p><code class="docutils literal notranslate"><span class="pre">fields</span></code> には出力項目を列挙します。YAMLのリスト形式のほか、空白区切りで項目を列挙する書き方もできます。また、例に示したとおり、YAMLの記法を使って複数行で書くこともできます。
<code class="docutils literal notranslate"><span class="pre">structure</span></code> は結晶構造データで、取得したデータはCIF形式で出力されます。 <code class="docutils literal notranslate"><span class="pre">band_gap</span></code> はバンドギャップの数値、 <code class="docutils literal notranslate"><span class="pre">symmetry</span></code> は対称性の情報です。この他に、 <code class="docutils literal notranslate"><span class="pre">material_id</span></code> で Materials Project 内の物質データのインデックスと、 <code class="docutils literal notranslate"><span class="pre">formula_pretty</span></code> で組成式が暗黙的に取得されます。出力項目の一覧は Appendix を参照してください。また、getcif コマンドのヘルプメッセージにも一覧が出力されます。</p>
</section>
<section id="id3">
<h2>データを取得する<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>入力パラメータファイル(input.yaml)を引数として getcif を実行します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>getcif<span class="w"> </span>input.yaml
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">getcif</span></code> を実行すると Materials Project のデータベースに接続し、検索条件に合致するデータを取得します。標準出力には、以下のように、物質の material ID と組成式、データ項目のサマリーが出力されます。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>material_id  formula  band_gap  symmetry  formula_pretty
mp-861502  AcFeO3  0.9887999999999995  crystal_system=&lt;CrystalSystem.cubic: &#39;Cubic&#39;&gt; symbol=&#39;Pm-3m&#39; number=221 point_group=&#39;m-3m&#39; symprec=0.1 version=&#39;2.0.2&#39;  AcFeO3
mp-977455  PaAgO3  0.915  crystal_system=&lt;CrystalSystem.cubic: &#39;Cubic&#39;&gt; symbol=&#39;Pm-3m&#39; number=221 point_group=&#39;m-3m&#39; symprec=0.1 version=&#39;2.0.2&#39;  PaAgO3
mp-11775  RbUO3  0.45420000000000016  crystal_system=&lt;CrystalSystem.cubic: &#39;Cubic&#39;&gt; symbol=&#39;Pm-3m&#39; number=221 point_group=&#39;m-3m&#39; symprec=0.1 version=&#39;2.0.2&#39;  RbUO3
mp-3163  BaSnO3  0.37239999999999984  crystal_system=&lt;CrystalSystem.cubic: &#39;Cubic&#39;&gt; symbol=&#39;Pm-3m&#39; number=221 point_group=&#39;m-3m&#39; symprec=0.1 version=&#39;2.0.2&#39;  BaSnO3
mp-4126  KUO3  0.44540000000000024  crystal_system=&lt;CrystalSystem.cubic: &#39;Cubic&#39;&gt; symbol=&#39;Pm-3m&#39; number=221 point_group=&#39;m-3m&#39; symprec=0.1 version=&#39;2.0.2&#39;  KUO3
mp-865322  UTlO3  0.27360000000000007  crystal_system=&lt;CrystalSystem.cubic: &#39;Cubic&#39;&gt; symbol=&#39;Pm-3m&#39; number=221 point_group=&#39;m-3m&#39; symprec=0.1 version=&#39;2.0.2&#39;  UTlO3
mp-753781  EuHfO3  0.4795999999999996  crystal_system=&lt;CrystalSystem.cubic: &#39;Cubic&#39;&gt; symbol=&#39;Pm-3m&#39; number=221 point_group=&#39;m-3m&#39; symprec=0.1 version=&#39;2.0.2&#39;  EuHfO3
</pre></div>
</div>
<p>取得したデータは、 <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> で指定した result ディレクトリ内に物質ごとに格納されます。この例では、 result 以下に mp-3163 から mp-977455 までの 7つのディレクトリが作成され、各ディレクトリには次のファイルが書き込まれます。</p>
<blockquote>
<div><ul>
<li><p>band_gap</p>
<blockquote>
<div><p>バンドギャップの値</p>
</div></blockquote>
</li>
<li><p>formula</p>
<blockquote>
<div><p>組成式 (formula_pretty に対応します)</p>
</div></blockquote>
</li>
<li><p>structure.cif</p>
<blockquote>
<div><p>CIF形式の結晶構造データ</p>
</div></blockquote>
</li>
<li><p>symmetry</p>
<blockquote>
<div><p>対称性に関するデータ</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">getcif</span></code> の実行に <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> オプションを付けると、以下のように検索条件を出力して終了します。データベースに実際に接続する前に検索項目を確認できます。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ getcif --dry-run input.yaml
{&#39;band_gap&#39;: (None, 1.0), &#39;is_stable&#39;: True, &#39;is_metal&#39;: False, &#39;formula&#39;: &#39;**O3&#39;, &#39;spacegroup_symbol&#39;: &#39;Pm-3m&#39;, &#39;fields&#39;: [&#39;structure&#39;, &#39;band_gap&#39;, &#39;symmetry&#39;, &#39;material_id&#39;, &#39;formula_pretty&#39;]}
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">cif2x Users Guide</a></h1>








<h3>ナビゲーション</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../cif2x/index.html">第一原理計算入力ファイル生成ツール (cif2x)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../cif2x/about/index.html">1. 概要</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cif2x/basic-usage.html">2. インストールと基本的な使い方</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cif2x/tutorial/index.html">3. チュートリアル</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cif2x/command/index.html">4. コマンドリファレンス</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cif2x/filespec/index.html">5. ファイルフォーマット</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cif2x/appendix/index.html">6. 拡張ガイド</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">7. CIFデータ取得ツール (getcif)</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../../cif2x/index.html">第一原理計算入力ファイル生成ツール (cif2x)</a><ul>
  <li><a href="../index.html"><span class="section-number">7. </span>CIFデータ取得ツール (getcif)</a><ul>
      <li>Previous: <a href="../about/index.html" title="前の章へ"><span class="section-number">7.1. </span>概要</a></li>
      <li>Next: <a href="../command/index.html" title="次の章へ"><span class="section-number">7.3. </span>コマンドリファレンス</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2023-, The University of Tokyo.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../_sources/getcif/tutorial/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>